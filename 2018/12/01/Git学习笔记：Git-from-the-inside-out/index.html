<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"xuquan.site","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Git from the inside outgit对我来说，依然是一个黑洞啊！！！！">
<meta property="og:type" content="article">
<meta property="og:title" content="「翻译」从里到外搞懂Git">
<meta property="og:url" content="https://xuquan.site/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/index.html">
<meta property="og:site_name" content="Nikkkki&#39;s Notes">
<meta property="og:description" content="Git from the inside outgit对我来说，依然是一个黑洞啊！！！！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrn2b8v6sj31di07cmxb.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrn5yzugtj31di09st8z.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrndaw8bpj31di0eot9a.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrnq5mpmwj31di0h43zs.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrntxmm9cj31di0h4dh4.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxrnw20nthj31di0h40u1.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxro38sjmoj31di0h4dh6.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxro56kfhtj31di0h4wf8.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxrpdzzjh0j31di0h4dgn.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxrpjgen20j31di0h4q3q.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrpsngmesj31di0h43zh.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrpxrpkg2j31di0fw3zd.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrq5jort9j31di0fwt9k.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrqazmrl6j31di0fwdgr.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxrqegzljkj31di0fw3zf.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxs8dpnncnj31di0h40tn.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxs8l21trrj31di0h40tn.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsa6zyrryj31di0h4ab1.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsae6rrmwj31di0h4wfj.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxsaitww6uj31di0h4abc.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb23jkqmj31di0h4myd.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fxsb3vzmrej31di0igabe.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb5ccfmaj31di0ig3zt.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb6wioqaj31di0ig0u3.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxsb9omz18j31ay0u0ac1.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxsbgm4l6sj31ay0u040p.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxshpa0es1j31ay0u0mzq.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxshw5jqwrj31ay0u0jtw.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsro47bt2j30pm0cx74y.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNbRwgy1fxss4il1mnj30pj0ggq4d.jpg">
<meta property="article:published_time" content="2018-12-01T10:44:21.000Z">
<meta property="article:modified_time" content="2018-12-02T15:29:15.000Z">
<meta property="article:author" content="Xu Quan（Nikkkki）">
<meta property="article:tag" content="git">
<meta property="article:tag" content="翻译">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrn2b8v6sj31di07cmxb.jpg">


<link rel="canonical" href="https://xuquan.site/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://xuquan.site/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/","path":"2018/12/01/Git学习笔记：Git-from-the-inside-out/","title":"「翻译」从里到外搞懂Git"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>「翻译」从里到外搞懂Git | Nikkkki's Notes</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Nikkkki's Notes</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.</span> <span class="nav-text">创建一个项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%93%E5%BA%93"><span class="nav-number">2.</span> <span class="nav-text">初始化仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">添加文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E5%86%85%E5%AE%B9"><span class="nav-number">4.</span> <span class="nav-text">提交内容</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%91%E5%BD%A2%E5%9B%BE%E5%BD%A2"><span class="nav-number">4.1.</span> <span class="nav-text">创建树形图形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.2.</span> <span class="nav-text">创建一个提交对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E5%BD%93%E6%9C%9F%E5%88%86%E6%94%AF%E6%8C%87%E5%90%91%E6%96%B0%E6%8F%90%E4%BA%A4"><span class="nav-number">4.3.</span> <span class="nav-text">将当期分支指向新提交</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%8D%E6%AC%A1%E6%8F%90%E4%BA%A4"><span class="nav-number">5.</span> <span class="nav-text">再次提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E5%88%B0%E6%9F%90%E6%AC%A1%E6%8F%90%E4%BA%A4"><span class="nav-number">6.</span> <span class="nav-text">切换到某次提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF"><span class="nav-number">7.</span> <span class="nav-text">创建一个分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E5%88%86%E6%94%AF"><span class="nav-number">8.</span> <span class="nav-text">切换分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%89%AF%E6%9C%AC%E4%B8%8D%E5%8C%B9%E9%85%8D%E7%9A%84%E5%88%86%E6%94%AF"><span class="nav-number">9.</span> <span class="nav-text">切换到与工作副本不匹配的分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E7%A5%96%E5%85%88"><span class="nav-number">10.</span> <span class="nav-text">合并祖先</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E5%90%8E%E4%BB%A3"><span class="nav-number">11.</span> <span class="nav-text">合并后代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E4%B8%8D%E5%90%8C%E6%BA%90%E6%8F%90%E4%BA%A4"><span class="nav-number">12.</span> <span class="nav-text">合并两个不同源提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E4%BF%AE%E6%94%B9%E4%BA%86%E7%9B%B8%E5%90%8C%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8D%E5%90%8C%E6%BA%90%E6%8F%90%E4%BA%A4"><span class="nav-number">13.</span> <span class="nav-text">合并修改了相同文件的不同源提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="nav-number">14.</span> <span class="nav-text">删除文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E4%BB%93%E5%BA%93"><span class="nav-number">15.</span> <span class="nav-text">复制仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E4%B8%A4%E4%B8%AA%E4%BB%93%E5%BA%93"><span class="nav-number">16.</span> <span class="nav-text">连接两个仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E8%8E%B7%E5%8F%96%E5%88%86%E6%94%AF"><span class="nav-number">17.</span> <span class="nav-text">从远程仓库获取分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6FETCH-HEAD"><span class="nav-number">18.</span> <span class="nav-text">合并FETCH_HEAD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E6%8B%89%E5%88%86%E6%94%AF"><span class="nav-number">19.</span> <span class="nav-text">从远程仓库拉分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%8B%E9%9A%86%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93"><span class="nav-number">20.</span> <span class="nav-text">克隆一个仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E5%86%85%E5%AE%B9%E6%8E%A8%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E5%88%86%E6%94%AF"><span class="nav-number">21.</span> <span class="nav-text">将内容推到远程仓库的分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%8B%E9%9A%86%E4%B8%80%E4%B8%AAbare%E4%BB%93%E5%BA%93"><span class="nav-number">22.</span> <span class="nav-text">克隆一个bare仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E5%88%86%E6%94%AF%E6%8E%A8%E5%88%B0bare%E4%BB%93%E5%BA%93"><span class="nav-number">23.</span> <span class="nav-text">将分支推到bare仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">24.</span> <span class="nav-text">小结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Xu Quan（Nikkkki）"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Xu Quan（Nikkkki）</p>
  <div class="site-description" itemprop="description">一个程序员的自我进修之路</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">217</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/XuQuan-nikkkki" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;XuQuan-nikkkki" rel="noopener me" target="_blank"><i class="fa-brands fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xuquan1225@gmail.com" title="E-Mail → mailto:xuquan1225@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.douban.com/people/nikkkki/?_i=8570912tq6k9lM" title="Douban → https:&#x2F;&#x2F;www.douban.com&#x2F;people&#x2F;nikkkki&#x2F;?_i&#x3D;8570912tq6k9lM" rel="noopener me" target="_blank"><i class="fa fa-book fa-fw"></i>Douban</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xuquan.site/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Xu Quan（Nikkkki）">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikkkki's Notes">
      <meta itemprop="description" content="一个程序员的自我进修之路">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="「翻译」从里到外搞懂Git | Nikkkki's Notes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          「翻译」从里到外搞懂Git
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-12-01 18:44:21" itemprop="dateCreated datePublished" datetime="2018-12-01T18:44:21+08:00">2018-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2018-12-02 23:29:15" itemprop="dateModified" datetime="2018-12-02T23:29:15+08:00">2018-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
    <span id="/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/" class="post-meta-item leancloud_visitors" data-flag-title="「翻译」从里到外搞懂Git" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/12/01/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AGit-from-the-inside-out/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/12/01/Git学习笔记：Git-from-the-inside-out/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a target="_blank" rel="noopener" href="https://maryrosecook.com/blog/post/git-from-the-inside-out">Git from the inside out</a><br>git对我来说，依然是一个黑洞啊！！！！</p>
<span id="more"></span>

<p>这篇论文旨在解释Git是如何运作的。</p>
<p>我们假设读者已经足够了解Git，并能够使用git来实现对自己项目的版本控制。文章重点讲解了实现Git功能的图形结构(graph structure)以及图形结构如何体现Git的操作内容。从基础入手能够帮助你将自己对git 的理解建立在实现原理上，而非通过对API的反复试错从而获得的对原理的猜想。这样能让你更了解Git做了什么，正在做什么， 会执行什么操作。</p>
<h3 id="创建一个项目"><a href="#创建一个项目" class="headerlink" title="创建一个项目"></a>创建一个项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ $ <span class="built_in">mkdir</span> alpha</span><br><span class="line">~ $ <span class="built_in">cd</span> alpha</span><br></pre></td></tr></table></figure>

<p>用户为自己的项目创建了<code>alpha</code>文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">mkdir</span> data</span><br><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;a&#x27;</span> &gt; data/letter.txt</span><br></pre></td></tr></table></figure>

<p>进入到<code>alpha</code>文件夹后，创建了一个叫做<code>data</code>的目录。在<code>data</code>目录下，创建了一个名为<code>letter.txt</code>的文件，它的内容是<code>a</code>。此时<code>alpha</code>目录的路径如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alpha</span><br><span class="line">	- data</span><br><span class="line">		- letter.txt</span><br></pre></td></tr></table></figure>



<h3 id="初始化仓库"><a href="#初始化仓库" class="headerlink" title="初始化仓库"></a>初始化仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git init</span><br><span class="line">					Initialized empty Git repository</span><br></pre></td></tr></table></figure>

<p><code>git init</code>将当期路径初始化为一个Git仓库。这一操作会创建一个<code>.git</code>目录，并且对它写入一些文件内容。这些文件定义了关于Git设置和项目历史的所有内容。它们仅仅是普通的文件，并没有什么特别之处。用户可以阅读它们，也可以通过编辑器或shell来编辑它们。也就是说，用户可以轻易地阅读和编辑项目历史，就像编辑其他文件那样。</p>
<p>此时，<code>alpha</code>目录路径如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alpha</span><br><span class="line">	- data</span><br><span class="line">		- letter.txt</span><br><span class="line">  - .git</span><br><span class="line">  	- objects</span><br><span class="line">  - etc...</span><br></pre></td></tr></table></figure>

<p><code>.git</code>目录和它们的内容都属于Git，所有其他的文件都统称为工作副本(working copy)。它们是用户的文件。</p>
<h3 id="添加文件"><a href="#添加文件" class="headerlink" title="添加文件"></a>添加文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git add data/letter.txt</span><br></pre></td></tr></table></figure>

<p>当用户对<code>data/letter.txt</code>文件执行<code>git add</code> 操作时，会发生两件事：</p>
<p>第一， 会在<code>.git/objects/</code>路径中新创建一个blob文件</p>
<p>这个blob文件包含了<code>data/letter.txt</code>文件的压缩内容。它的名字来源于对它的内容的hash处理。对一段文本进行hash处理意味着在这段文本上执行一个程序，将它转换成更小片段的文本，同时能够独一无二地识别到原文本。举个例子，Git将<code>a</code>hash处理为<code>2e65efe2a145dda7ee51d1741299f848e5bf752e</code>。开头的两个字符被用作Git对象数据中的路径名：<code>.git/objects/2e</code>。剩余的hash内容作为承载文本内容的blob文件的名字：<code>.git/objects/2e/65efe2a145dda7ee51d1741299f848e5bf752e</code>。</p>
<p>由此可以看到添加文件到Git会将文件内容存储到<code>objects</code>路径下。即使用户从工作副本中删除了<code>data/letter.txt</code>文件，文件内容在Git中依然是安全的。</p>
<p>第二，<code>git add</code>将文件添加到索引中。索引(index)是一个包含了所有要求Git跟踪的文件的列表。它被保存在<code>.git/index</code>中。文件的每一行文件都映射到它被添加时的内容的hash值。以下是<code>git add</code>命令执行后的索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data/letter.txt 2e65efe2a145dda7ee51d1741299f848e5bf752e</span><br></pre></td></tr></table></figure>

<p>用户创建了一个叫做<code>data/number.txt</code>的文件，内容是<code>1234</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;1234&#x27;</span> &gt; data/number.txt</span><br></pre></td></tr></table></figure>

<p>工作副本的路径如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alpha</span><br><span class="line">	- data</span><br><span class="line">		- letter.txt</span><br><span class="line">		- number.txt</span><br></pre></td></tr></table></figure>

<p>用户将文件添加到Git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git add data</span><br></pre></td></tr></table></figure>

<p><code>git add</code>命令创建了一个包含<code>data/number.txt</code>内容的blob对象。还为<code>data/number.txt</code>添加了一个指向blob文件的索引入口。以下是<code>git add</code>命令第二次执行后的索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data/letter.txt 2e65efe2a145dda7ee51d1741299f848e5bf752e</span><br><span class="line">data/number.txt 274c0052dd5408f8ae2bc8440029ff67d79bc5c3</span><br></pre></td></tr></table></figure>

<p>尽管用户执行的是<code>git add data</code>，但只有<code>data</code>路径下的文件罗列在索引中，<code>data</code>索引并没有列在其中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;1&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data</span><br></pre></td></tr></table></figure>

<p>当用户最初创建<code>data/number.txt</code>时，他们实际希望文件内容是<code>1</code>，而非<code>1234</code>，于是他们修改了文件的内容，并重新添加到git中。这次操作会创建一个包含新内容的新blob文件，同时在索引中更新<code>data/number.txt</code>文件的入口，使其指向新的blob文件。</p>
<h3 id="提交内容"><a href="#提交内容" class="headerlink" title="提交内容"></a>提交内容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git commit -m <span class="string">&#x27;a1&#x27;</span></span><br><span class="line">					[master (root-commit) 774b54a] a1</span><br></pre></td></tr></table></figure>

<p>用户创建了内容为<code>a1</code>的提交。Git会显示关于这次提交的一些信息。这些信息会立马生效。</p>
<p>提交命令实际包含三个步骤：创建一个表示当前版本的提交内容的树形图形；创建一个提交对象；将当前分支指向新的提交对象。</p>
<h4 id="创建树形图形"><a href="#创建树形图形" class="headerlink" title="创建树形图形"></a>创建树形图形</h4><p>Git通过索引来创建一个树形图形，从而记录项目的当前状态。这个树形图形会记录项目中每个文件的位置和内容。</p>
<p>这个图形包含两个类型的对象：blobs和trees。</p>
<p>blobs通过<code>git add</code>来创建，它们用来表示文件的内容。</p>
<p>trees是在提交时创建的。一个树表示工作副本中的一个路径。</p>
<p>下面是记录<code>data</code>路径的新提交内容的树对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100664 blob 2e65efe2a145dda7ee51d1741299f848e5bf752e letter.txt</span><br><span class="line">100664 blob 56a6051ca2b02b04ef92d5150c9ef600403cb1de number.txt</span><br></pre></td></tr></table></figure>

<p>第一行记录了所有用来重新生成<code>data/letter.txt</code>文件的内容。第一部分指文件许可，第二部分表示指向当前内容的是一个blob文件，第三部分是这个blob文件的hash值，第四部分是这个文件的名称。</p>
<p>第二行记录了<code>data/number.txt</code>文件的相关内容。</p>
<p>下面是<code>alpha</code>路径的树对象，即当前项目的根路径的树对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">040000 tree 0eed1217a2947f4930583229987d90fe5e8e0b74 data</span><br></pre></td></tr></table></figure>

<p>这单独的一行将这个树指向了<code>data</code>树。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrn2b8v6sj31di07cmxb.jpg" alt="Tree graph for the `a1` commit"></p>
<p>图中，<code>root</code>树指向<code>data</code>树，<code>data</code>树指向表示<code>data/letter.txt</code>和<code>data/number.txt</code>的blob文件。</p>
<h4 id="创建一个提交对象"><a href="#创建一个提交对象" class="headerlink" title="创建一个提交对象"></a>创建一个提交对象</h4><p><code>git commit</code>在创建了树形图形后会创建一个提交对象。提交对象是<code>.git/objects/</code>路径中的另一个文本文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tree ffe298c3ce8bb07326f888907996eaa48d266db4</span><br><span class="line">author Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1424798436 -0500</span><br><span class="line">committer Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1424798436 -0500</span><br><span class="line"></span><br><span class="line">a1</span><br></pre></td></tr></table></figure>

<p>第一行指向树形图形，hash值指向表示工作副本中根路径的树对象，也就是<code>alpha</code>路径。最后一行是提交信息。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrn5yzugtj31di09st8z.jpg" alt="`a1` commit object pointing at its tree graph"></p>
<h4 id="将当期分支指向新提交"><a href="#将当期分支指向新提交" class="headerlink" title="将当期分支指向新提交"></a>将当期分支指向新提交</h4><p>最后，提交命令将当期分支指向新的提交对象。哪一个是当前分支呢？Git会到<code>.git/HEAD</code>路径中寻找<code>HEAD</code>文件，并找到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>这是说<code>HEAD</code>正指向<code>master</code>，<code>master</code>是当前分支。</p>
<p><code>HEAD</code>和<code>master</code>都是引用。引用是Git或用户用来标记一个特定的提交的标签。</p>
<p>代表<code>master</code>引用的文件还不存在，因为这是仓库的第一次提交。Git会在<code>.git/refs/heads/master</code>中创建一个文件，并将内容设置为此次提交对象的hash值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">74ac3ad9cde0b265d2b4f1c778b283a6e2ffbafd</span><br></pre></td></tr></table></figure>

<p>（如果你正在试着复现以上阅读到的Git操作，你会发现你的<code>a1</code>提交的hash值会和我的不一样。像blob这类内容对象和树对象会总是转换到相同的hash值，但是提交对象不会，因为它们还包含了日期和创建者的名字等信息）</p>
<p>现在让我们添加<code>HEAD</code>和<code>master</code>到Git图形：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrndaw8bpj31di0eot9a.jpg" alt="`master` pointing at the `a1` commit"></p>
<p><code>HEAD</code>和提交之前一样指向<code>master</code>，但是<code>master</code>现在指向新的提交对象。</p>
<h3 id="再次提交"><a href="#再次提交" class="headerlink" title="再次提交"></a>再次提交</h3><p>下面是<code>a1</code>提交之后的Git图形。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrnq5mpmwj31di0h43zs.jpg" alt="`a1` commit shown with the working copy and index"></p>
<p>工作副本，索引和<code>a1</code>提交中&#96;&#96;data&#x2F;letter.txt<code>和</code>data&#x2F;number.txt<code>的内容是相同的。索引和</code>HEAD&#96;的提交都使用hash值来引用blob对象，但是工作副本的内容是用文本的形式存储在其他地方的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;2&#x27;</span> &gt; data/number.txt</span><br></pre></td></tr></table></figure>

<p>用户将<code>data/number.txt</code>的内容设为<code>2</code>。这样就更新了工作副本的内容，但是索引和<code>HEAD</code>提交保持不变。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrntxmm9cj31di0h4dh4.jpg" alt="`data/number.txt` set to `2` in the working copy"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git add data/number.txt</span><br></pre></td></tr></table></figure>

<p>用户将文件添加到Git中。这时会在<code>objects</code>目录下添加一个内容为<code>2</code>的blob文件，<code>data/number.txt</code>的索引指向新的blob文件。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxrnw20nthj31di0h40u1.jpg" alt="`data/number.txt` set to `2` in the working copy and index"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git commit -m <span class="string">&#x27;a2&#x27;</span></span><br><span class="line">					[master f07af7e6] a2</span><br></pre></td></tr></table></figure>

<p>用户提交了修改，这一步和之前的提交步骤是一样的。</p>
<p>首先，一个新的树形图形被创建出来，用来表示索引的内容。</p>
<p><code>data/number.txt</code>的索引入口被修改了。之前的<code>data</code>树不再映射到<code>data</code>目录，新的<code>data</code>树对象必须创建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100664 blob 2e65efe2a145dda7ee51d1741299f848e5bf752e letter.txt</span><br><span class="line">100664 blob d8263ee9860594d2806b0dfd1bfd17528b0ba2a4 number.txt</span><br></pre></td></tr></table></figure>

<p>新的<code>data</code>树被hash处理为不同于之前的<code>data</code>树的值。新的<code>root</code>树必须被创建，用来记录这个新的hash值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">040000 tree 40b0318811470aaacc577485777d7a6780e51f0b data</span><br></pre></td></tr></table></figure>

<p>第二，新的提交对象被创建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tree ce72afb5ff229a39f6cce47b00d1b0ed60fe3556</span><br><span class="line">parent 774b54a193d6cfdd081e581a007d2e11f784b9fe</span><br><span class="line">author Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1424813101 -0500</span><br><span class="line">committer Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1424813101 -0500</span><br><span class="line"></span><br><span class="line">a2</span><br></pre></td></tr></table></figure>

<p>提交对象的第一行执行新的<code>root</code>树对象。第二行执行<code>a1</code>：此次提交的父提交。为了找到父提交，Git找到<code>HEAD</code>,通过<code>HEAD</code>找到<code>master</code>并找到<code>a1</code>提交的hash值。</p>
<p>第三步，<code>master</code>分支的文件内容被修改为新提交的hash值。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxro38sjmoj31di0h4dh6.jpg" alt="`a2` commit"></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxro56kfhtj31di0h4wf8.jpg" alt="Git graph without the working copy and index"></p>
<p>图形解读：内容以对象的形式存储在树上。也就是说只有变动的内容才存储到对象数据库中。上图中可以看到，<code>a2</code>提交复用了<code>a1</code>提交前就创建的<code>a</code>blob文件。类似的，如果整个目录在一次次提交中都未做任何修改，那么它的树和所有的blobs文件以及树下的其他树对象都可以被复用。通常提交过程中都会有一些内容被修改，这意味着Git可以只用很小的空间来存储大量的提交历史。</p>
<p>图形解读：每一次提交都有父提交。这意味着Git仓库可以存储整个项目的历史</p>
<p>图形解读：引用指向一个提交历史中的一部分。也就是说提交可以被赋予有意义的名字。用户可以通过给引用使用有意义的命名，如<code>fix-for-bug-376</code>来安排项目工作。Git提供<code>HEAD</code>,<code>MERGE_HEAD</code>,<code>FETCH_HEAD</code>这类有指向意义的引用来操作提交历史。</p>
<p>图形解读：<code>objects/</code>目录下的节点是不可改变的。也就是说，内容会被修改，不会被删除。每一个被添加的内容和每一次创建的提交都在<code>objects</code>目录中的某个地方。</p>
<p>图形解读：引用是可变的。因此，引用的意义也可以被修改。<code>master</code>分支指向的提交可能是当前项目中最好的版本，但是很快它也可能会被更新和更好的提交所取代。</p>
<p>图形解读：引用指向的工作副本和提交可以读取到，但是其他的提交则不行。这也意味着近期的历史很容易被重现，但是它也会经常更改。</p>
<p>工作副本是历史中最容易复现的，因为它们在仓库的根目录下。复现它们甚至不需要Git命令。它们同时也是历史中保存时间最短的，用户可以创建一个文件的无数个版本，但是Git不会记录它们，除非用户主动添加它们。</p>
<p><code>HEAD</code>指向的提交也非常容易复现。因为它指向刚刚切换到的分支。要想查看它的内容，用户可以使用stash，并检查工作副本。同时，<code>HEAD</code>也是最经常更改的引用。</p>
<p>一个具体的引用指向的提交也是容易复现的。用户只需要切换到这个分支。这个分支的更改没有<code>HEAD</code>那么频繁。</p>
<p>不被任何引用指向的提交时很难被复现的。用户不再使用一个引用越久，他们理解该引用的提交就越难。但用户不使用的时间越久，其实也不太会有什么新的更改历史。</p>
<h3 id="切换到某次提交"><a href="#切换到某次提交" class="headerlink" title="切换到某次提交"></a>切换到某次提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout 37888c2</span><br><span class="line">					You are <span class="keyword">in</span> <span class="string">&#x27;detached HEAD&#x27;</span> state...</span><br></pre></td></tr></table></figure>

<p>用户通过hash值查看<code>a2</code>提交。</p>
<p>切换包括四个步骤：</p>
<p>第一，Git找到<code>a2</code>提交以及它指向的树形图形</p>
<p>第二，修改树形图形中的文件入口，使其指向工作副本。这不会产生任何变化，工作副本已经有了树形图形的内容，因为<code>HEAD</code>已经通过<code>master</code>指向<code>a2</code>提交</p>
<p>第三，Git在树形图形中将文件入口修改指向索引。这样不会有任何变化，因为已经有了<code>a2</code>提交的内容。</p>
<p>第四，<code>HEAD</code>的内容设置为<code>a2</code>提交的hash值</p>
<p>修改<code>HEAD</code>的内容到某个hash值会让整个仓库处于脱离的<code>HEAD</code>的状态。注意下图中的<code>HEAD</code>直接指向<code>a2</code>提交，而不是指向<code>master</code></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxrpdzzjh0j31di0h4dgn.jpg" alt="Detached `HEAD` on `a2` commit"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;3&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;a3&#x27;</span></span><br><span class="line">					[detached HEAD 3645a0e] a3</span><br></pre></td></tr></table></figure>

<p>用户将<code>data/number.txt</code>的内容设为<code>3</code>，并提交了此次修改。Git通过<code>HEAD</code>来找到<code>a3</code>提交的父提交。不像之前需要找到并顺着某个分支引用来查找，这次直接找到并返回<code>a2</code>提交的hash值。</p>
<p>Git更新<code>HEAD</code>直接到<code>a3</code>提交的hash值，仓库依然处于脱离的<code>HEAD</code>状态。提交不再任何一个分支上，因为没有分支指向<code>a3</code>或它的后代。这意味着这些提交很容易丢失。</p>
<p>到目前为止，树和blob会在图形中被忽略。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxrpjgen20j31di0h4q3q.jpg" alt="`a3` commit that is not on a branch"></p>
<h3 id="创建一个分支"><a href="#创建一个分支" class="headerlink" title="创建一个分支"></a>创建一个分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git branch deputy</span><br></pre></td></tr></table></figure>

<p>用户创建了一个新的<code>deputy</code>分支，这样会在<code>.git/refs/heads/deputy</code>路径创建一个新的文件，文件内容是<code>HEAD</code>指向的提交的hash值，即<code>a3</code>提交的hash值。</p>
<p>图形解读：分支即引用，引用即文件，这意味着Git的分支都是轻量级的。</p>
<p>创建<code>deputy</code>分支让<code>a3</code>提交能够安全地保存在一个分支上，<code>HEAD</code>仍然是脱离的，因为它依然直接指向了一个提交。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrpsngmesj31di0h43zh.jpg" alt="`a3` commit now on the `deputy` branch"></p>
<h3 id="切换分支"><a href="#切换分支" class="headerlink" title="切换分支"></a>切换分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout master</span><br><span class="line">					Switched to branch <span class="string">&#x27;master&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户切换到<code>master</code>分支。</p>
<p>首先，Git找到<code>master</code>指向的<code>a2</code>提交以及<code>a2</code>指向的树形图形。</p>
<p>第二步，Git改写树形图形中指向工作副本的文件入口，将<code>data/number.txt</code>的内容设置为<code>2</code></p>
<p>第三步，Git改写树形图形中指向索引的文件入口，将<code>data/number.txt</code>的入口更新为<code>2</code>blob对应的hash值</p>
<p>第四步，Git通过修改以下内容以将<code>HEAD</code>指向<code>master</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxrpxrpkg2j31di0fw3zd.jpg" alt="`master` checked out and pointing at the `a2` commit"></p>
<h3 id="切换到与工作副本不匹配的分支"><a href="#切换到与工作副本不匹配的分支" class="headerlink" title="切换到与工作副本不匹配的分支"></a>切换到与工作副本不匹配的分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;789&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git checkout deputy</span><br><span class="line">					Your changes to these files would be overwritten by checkout: </span><br><span class="line">						data/number.txt</span><br><span class="line">					Commit your changes or stash them before you switch branches</span><br></pre></td></tr></table></figure>

<p>用户意外地将<code>data/number.txt</code>的内容设置为<code>789</code>。当他们想要切换到<code>deputy</code>分支时，Git阻止了这次切换。</p>
<p><code>HEAD</code>正指向<code>master</code>，<code>master</code>指向了<code>a2</code>提交，<code>a2</code>提交中<code>data/number.txt</code>的内容为<code>2</code>。<code>deputy</code>指向<code>a3</code>，<code>a3</code>提交中<code>data/number.txt</code>的内容为<code>3</code>。工作副本中<code>data/number.txt</code>的当前版本为<code>789</code>。这几个版本都是不一样的，必须先解决这些冲突。</p>
<p>Git可以将工作副本中<code>data/number.txt</code>的内容替换为要切换到的分支的提交中的内容，但它会建立避免数据丢失。</p>
<p>Git也可以合并工作副本的当前版本和切换到的分支的版本，但是这样非常复杂。</p>
<p>所以，Git放弃了这次切换。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;2&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git checkout deputy</span><br><span class="line">					Switched to branch <span class="string">&#x27;deputy&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户注意到了他们不小心修改了<code>data/number.txt</code>的内容，并将内容修改会原来的<code>2</code>。然后成功切换到<code>deputy</code>分支。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrq5jort9j31di0fwt9k.jpg" alt="`deputy` checked out"></p>
<h3 id="合并祖先"><a href="#合并祖先" class="headerlink" title="合并祖先"></a>合并祖先</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git merge master</span><br><span class="line">					Already up-to-date</span><br></pre></td></tr></table></figure>

<p>用户将<code>master</code>合并进<code>deputy</code>。合并两个分支意味着核名两个提交。第一个提交是<code>deputy</code>指向的提交，即合并者。第二次提交是<code>master</code>指向的提交，即被合并者。这次合并中，Git没有做任何事情，所以它提示<code>Already up-to-date</code>。</p>
<p>图形截图：图形中的一系列提交可以理解为一些了对仓库内容的修改。也就是说，在合并中，如果被合并者是合并者的祖先，那么Git不会做任何事情，这些修改已经被合并了。</p>
<h3 id="合并后代"><a href="#合并后代" class="headerlink" title="合并后代"></a>合并后代</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~alpha $ git checkout master</span><br><span class="line">				Switched to branch <span class="string">&#x27;master&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户切换到<code>master</code></p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxrqazmrl6j31di0fwdgr.jpg" alt="`master` checked out and pointing at the `a2` commit"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git merge deputy</span><br><span class="line">					Fast-forward</span><br></pre></td></tr></table></figure>

<p>用户将<code>deputy</code>合并进<code>master</code>。Git发现合并者的提交<code>a2</code>是被合并者的提交<code>a3</code>的祖先，就会执行一次快进合并。</p>
<p>它找到被合并者的提交和这次提交指向的树形图形，改写树形图形中指向工作副本和索引的文件入口，快进<code>master</code>到<code>a3</code>。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxrqegzljkj31di0fw3zf.jpg" alt="`a3` commit from `deputy` fast-forward merged into `master`"></p>
<p>图形属性：图中一系列提交可以看做是一些了对仓库内容的修改。也就是说，当合并分支时，如果被合并者是合并者的后代，提交历史就不会被修改，合并者和被合并者直接的一系列提交已经存在。但是，尽管Git的修改历史没有改变，但是Git图形发生了变化。<code>HEAD</code>指向的引用变成了合并者的提交</p>
<h3 id="合并两个不同源提交"><a href="#合并两个不同源提交" class="headerlink" title="合并两个不同源提交"></a>合并两个不同源提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;4&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;a4&#x27;</span></span><br><span class="line">					[master 7b7bd9a] a4</span><br></pre></td></tr></table></figure>

<p>用户将<code>number.txt</code>的内容修改为<code>4</code>，并将修改提交给<code>master</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout deputy</span><br><span class="line">					Switched to branch <span class="string">&#x27;deputy&#x27;</span></span><br><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;b&#x27;</span> &gt; data/letter.txt</span><br><span class="line">~/alpha $ git add data/letter.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;b3&#x27;</span></span><br><span class="line">					[deputy 982dffb] b3</span><br></pre></td></tr></table></figure>

<p>用户切换到<code>deputy</code>分支，将<code>&#39;data/letter.txt</code>的内容修改为<code>b</code>，并提交到<code>deputy</code>分支上。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxs8dpnncnj31di0h40tn.jpg" alt="`a4` committed to `master`, `b3` committed to `deputy` and `deputy` checked out"></p>
<p>图形属性：提交可以共享父提交，也就是说新的源头可以在提交历史中被创建出来。</p>
<p>图形属性：一个提交可以有多个父提交。也就是说不同源的提交可以由一次提交来合并，即一次合并提交</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git merge master -m <span class="string">&#x27;b4&#x27;</span></span><br><span class="line">					Merge made by the <span class="string">&#x27;recursive&#x27;</span> strategy</span><br></pre></td></tr></table></figure>

<p>用户将<code>master</code>分支合并进<code>deputy</code>分支</p>
<p>Git发现合并者的<code>b3</code>提交和被合并者的<code>a4</code>提交是不同源的提交。所以需要做一次合并提交，整个过程包括8个步骤：</p>
<ol>
<li><p>Git将被合并者的提交的hash值写入到<code>alpha/.git/MERGE_HEAD</code>文件中。这个文件的存在用来告诉Git目前正在合并过程中</p>
</li>
<li><p>Git找到基准提交，即合并者和被合并者共同的最近的一次祖先提交</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxs8l21trrj31di0h40tn.jpg" alt="`a3`, the base commit of `a4` and `b3`"></p>
</li>
</ol>
<p>图形解读：提交都有父提交。也就是说向上追溯可以找到两个源头交汇的地方。Git分别从<code>b3</code>和<code>a4</code>向上寻找，直到找到最近的一次共同的父提交<code>a3</code>，那么<code>a3</code>就是基准提交。</p>
<ol start="3">
<li><p>Git通过树形图形分别为基准提交，合并者的提交和被合并者的提交创建索引</p>
</li>
<li><p>Git会创建一个对比（diff）来集合合并者和被合并者的提交对基准提交作出的改变。这个对比(diff)就是一个文件路径列表，每一条路径都指向一次修改，包括添加、删除、修改或者冲突</p>
<p>Git获取到记录了基准提交、合并者提交和被合并者提交的所有文件索引的列表，并逐一对比来确定对文件执行什么修改。Git会为每一条对比写入一个对应的入口，一条对比会有两个入口。</p>
<p>第一个入口是<code>data/letter.txt</code>，这个文件在基准提交中的内容是<code>a</code>，在合并者的内容是<code>b</code>，在被合并者的内容是<code>a</code>。基准提交和合并者的内容是不同的，但基准提交和被合并者的内容是相同的。Git看到内容被合并者而非被合并者修改，因此<code>data/letter.txt</code>的对比入口被定义为一次修改，而非冲突。</p>
<p>对比中的第二个内容是<code>data/number.txt</code>。在这个例子中，基准提交和合并者的内容是一样的，但是被合并者的内容是不一样的，<code>data/letter.txt</code>的对比入口也被定义为一次修改。</p>
<p>图形解读：找到合并的基准提交意味着当合并者或被合并者其中之一基于基准提交修改了文件，Git可以自动合并文件，这就减少了用户需要做的事情。</p>
</li>
<li><p>对比中的修改入口会被应用到工作副本中。<code>data/letter.txt</code>的内容被改为<code>b</code>，<code>data/number.txt</code>的内容被改为<code>4</code></p>
</li>
<li><p>对比中的修改入口会被应用到索引中，<code>data/letter.txt</code>会指向<code>b</code>blob文件，<code>data/number.txt</code>会指向<code>4</code>blob文件</p>
</li>
<li><p>更新后的索引会被提交</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tree 20294508aea3fb6f05fcc49adaecc2e6d60f7e7d</span><br><span class="line">parent 982dffb20f8d6a25a8554cc8d765fb9f3ff1333b</span><br><span class="line">parent 7b7bd9a5253f47360d5787095afc5ba56591bfe7</span><br><span class="line">author Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1425596551 -0500</span><br><span class="line">committer Mary Rose Cook &lt;mary@maryrosecook.com&gt; 1425596551 -0500</span><br><span class="line"></span><br><span class="line">b4</span><br></pre></td></tr></table></figure>

<p>注意到这次提交有两个父提交</p>
</li>
<li><p>Git指向当前分支<code>deputy</code>的新提交</p>
</li>
</ol>
<h3 id="合并修改了相同文件的不同源提交"><a href="#合并修改了相同文件的不同源提交" class="headerlink" title="合并修改了相同文件的不同源提交"></a>合并修改了相同文件的不同源提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout master</span><br><span class="line">					Switched to branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">~/alpha $ git merge deputy</span><br><span class="line">					Fast-forward</span><br></pre></td></tr></table></figure>

<p>用户切换到<code>master</code>分支，将<code>deputy</code>分支合并入<code>master</code>分支。这时会将<code>master</code>快进推到<code>b4</code>提交。此时<code>master</code>和<code>HEAD</code>指向同一次提交。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsa6zyrryj31di0h4ab1.jpg" alt="`deputy` merged into `master` to bring `master` up to the latest commit, `b4`"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout deputy</span><br><span class="line">					Switched to branch <span class="string">&#x27;deputy&#x27;</span></span><br><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;5&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;b5&#x27;</span></span><br><span class="line">					[deputy bd797c2] b5</span><br></pre></td></tr></table></figure>

<p>用户切换到<code>deputy</code>分支，将<code>data/number.txt</code>的内容改为<code>5</code>，并将修改提交到<code>deputy</code>分支。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git checkout master</span><br><span class="line">					Switched to branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;6&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;b6&#x27;</span></span><br><span class="line">					[master 4c3ce18] b6</span><br></pre></td></tr></table></figure>

<p>用户切换到<code>master</code>分支，他们将<code>data/number.txt</code>的内容修改为<code>6</code>，并将修改提交到<code>master</code></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsae6rrmwj31di0h4wfj.jpg" alt="`b5` commit on `deputy` and `b6` commit on `master`"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git merge deputy</span><br><span class="line">					CONFILICT <span class="keyword">in</span> data/number.txt</span><br><span class="line">					Automatic merge failed; fix conficts and commit the result</span><br></pre></td></tr></table></figure>

<p>用户将<code>deputy</code>合并到<code>master</code>分支，此时出现了冲突，合并停止。有冲突的合并过程和没有冲突的合并过程的前6个步骤是相同的：设置<code>.git/MERGE_HEAD</code>，找到基准提交，生成基准提交、合并者提交和被合并者提交的索引，创建对比，更新工作副本，更新索引。由于出现了冲突，第7、8步无法执行，那我们来看看每一步发生了什么：</p>
<ol>
<li><p>Git将被合并者提交的hash值写入到<code>.git/MERGE_HEAD</code></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxsaitww6uj31di0h4abc.jpg" alt="`MERGE_HEAD` written during merge of `b5` into `b6`"></p>
</li>
<li><p>找到基准提交<code>b4</code></p>
</li>
<li><p>生成基准提交、合并者提交和被合并者提交的索引</p>
</li>
<li><p>生成一个集合了合并者和被合并者提交的基于基准提交的修改对比</p>
<p>在这个例子中，这个对比只包含一个文件入口：<code>data/number.txt</code>。这个入口被标记为冲突，因为文件内容在基准提交、合并者和被合并者中都不相同</p>
</li>
<li><p>修改的内容被应用到工作副本中。冲突的部分，Git会将两个版本都写入文件，因此<code>data/number.txt</code>被写为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="string">HEAD</span></span><br><span class="line"><span class="string">6</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;&gt;&gt;&gt; deputy</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对比中标记的修改也被应用到索引中，索引中的文件入口标记了文件的路径和阶段。没有冲突的文件标记的阶段为<code>0</code>，在此次合并之前，索引应该如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 data/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748</span><br><span class="line">0 data/number.txt 62f9457511f879886bb7728c986fe10b0ece6bcb</span><br></pre></td></tr></table></figure>

<p>此次合并之后，对比写入索引，索引如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 data/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748</span><br><span class="line">1 data/number.txt bf0d87ab1b2b0ec1a11a3973d2845b42413d9767</span><br><span class="line">2 data/number.txt 62f9457511f879886bb7728c986fe10b0ece6bcb</span><br><span class="line">3 data/number.txt 7813681f5b41c028345ca62a2be376bae70b7f61</span><br></pre></td></tr></table></figure>

<p><code>data/letter.txt</code>的阶段为<code>0</code>，和合并之前一样。<code>data/number.txt</code>则有3个新的非<code>0</code>的入口出现。阶段为<code>1</code>的文件hash值指向基准提交的<code>data/number.txt</code>的内容，阶段为<code>2</code>的hash值指向合并者的文件内容，阶段为<code>3</code>的hash值指向被合并者的文件内容。这三个入口的存在告诉Git<code>data/number.txt</code>目前存在冲突。</p>
<p>合并停止</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;11&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br></pre></td></tr></table></figure>

<p>用户将<code>data/number.txt</code>的内容修改为<code>11</code>，并将文件添加到索引。Git新添加一个内容为<code>11</code>的blob文件，添加一个包含冲突的文件意味着告诉Git冲突已被解决。Git从索引中删除掉<code>data/number.txt</code>的阶段<code>1</code>,<code>2</code>,<code>3</code>的文件，添加<code>data/number.txt</code>阶段为<code>0</code>的入口，现在索引如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 data/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748</span><br><span class="line">0 data/number.txt 9d607966b721abde8931ddd052181fae905db503</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>用户提交。Git看到仓库中的<code>.git/MERGE_HEAD</code>，直到正在合并过程中。于是查看索引，看到并没有冲突，于是新创建一个<code>b11</code>提交，用来记录合并后的内容，并删除<code>.git/MERGE_HEAD</code>中的文件。合并完成。</li>
<li>Git将<code>master</code>指向新的提交</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb23jkqmj31di0h4myd.jpg" alt="`b11`, the merge commit resulting from the conflicted, recursive merge of `b5` into `b6`"></p>
</li>
</ol>
<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p>以下Git 图形包含了提交历史、最近一次提交的树形图形和Blob对象，工作副本和索引：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxsb3vzmrej31di0igabe.jpg" alt="The working copy, index, `b11` commit and its tree graph"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git <span class="built_in">rm</span> data/letter.txt</span><br><span class="line">					<span class="built_in">rm</span> <span class="string">&#x27;data/letter.txt&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户告诉git删除<code>data/letter.txt</code>文件。文件从工作副本中被删除。索引中的文件入口也被删除</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb5ccfmaj31di0ig3zt.jpg" alt="After `data/letter.txt` `rm`ed from working copy and index"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git commit -m <span class="string">&#x27;11&#x27;</span></span><br><span class="line">					[master d14c7d2] 11</span><br></pre></td></tr></table></figure>

<p>用户提交。作为提交的一个部分，Git创建一个树形图形来记录索引的内容。<code>data/letter.txt</code>不包含在树形吐信中，因为它不再索引中。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsb6wioqaj31di0ig0u3.jpg" alt="`11` commit made after `data/letter.txt` `rm`ed"></p>
<h3 id="复制仓库"><a href="#复制仓库" class="headerlink" title="复制仓库"></a>复制仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">cd</span> ..</span><br><span class="line">			~ $ <span class="built_in">cp</span> -R alpha bravo</span><br></pre></td></tr></table></figure>

<p>用户将<code>alpha/</code>仓库中的内容复制到<code>bravo/</code>路径下。这回创建如下路径结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~</span><br><span class="line">	- alpha</span><br><span class="line">		- data</span><br><span class="line">			- number.txt</span><br><span class="line">	- bravo</span><br><span class="line">		- data</span><br><span class="line">			- number.txt</span><br></pre></td></tr></table></figure>

<p><code>bravo</code>路径下会有另一个Git图形</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxsb9omz18j31ay0u0ac1.jpg" alt="New graph created when `alpha` `cp`ed to `bravo`"></p>
<h3 id="连接两个仓库"><a href="#连接两个仓库" class="headerlink" title="连接两个仓库"></a>连接两个仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">			~ $ <span class="built_in">cd</span> alpha</span><br><span class="line">~/alpha $ git remote add bravo ../bravo</span><br></pre></td></tr></table></figure>

<p>用户切回到<code>alpha</code>路径下，将<code>bravo</code>设置为<code>alpha</code>的远程仓库。这一操作会在<code>alpha/.git/config</code>中添加如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">&quot;bravo&quot;</span>]</span><br><span class="line">				url = ../bravo/</span><br></pre></td></tr></table></figure>

<p>这表明在路径<code>../bravo</code>下有一个名为<code>bravo</code>的远程仓库</p>
<h3 id="从远程仓库获取分支"><a href="#从远程仓库获取分支" class="headerlink" title="从远程仓库获取分支"></a>从远程仓库获取分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">cd</span> ../bravo</span><br><span class="line">~/bravo $ <span class="built_in">printf</span> <span class="string">&#x27;12&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/bravo $ git add data/number.txt</span><br><span class="line">~/bravo $ git commit -m <span class="string">&#x27;12&#x27;</span></span><br><span class="line">					[master 94cd04d] 12</span><br></pre></td></tr></table></figure>

<p>用户进入<code>bravo</code>仓库，将<code>data/number.txt</code>的内容设为<code>12</code>，并将修改提交到<code>bravo</code>的<code>master</code>上。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxsbgm4l6sj31ay0u040p.jpg" alt="`12` commit on `bravo` repository"></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/bravo $ <span class="built_in">cd</span> .../alpha</span><br><span class="line">~/alpha $ git fetch bravo master</span><br><span class="line">					Unpacking objects: 100%</span><br><span class="line">					From ../bravo</span><br><span class="line">						* branch master -&gt; FETCH_HEAD</span><br></pre></td></tr></table></figure>

<p>用户进入<code>alpha</code>仓库，他们获取远程<code>bravo</code>仓库的<code>master</code>分支，这个过程包括四个步骤：</p>
<ol>
<li><p>Git找到<code>bravo</code>仓库的<code>master</code>分支指向的提交的hash值，即提交<code>12</code>的hash值</p>
</li>
<li><p>Git创建一个新的列表，内容包括<code>12</code>提交依赖的所有内容：提交对象本身，树形图形中的对象，提交<code>12</code>的祖先提交，祖先提交的树形图形对象。<code>alpha</code>对象数据库已有的内容会从整个列表中移除，然后将其余的内容拷贝到<code>alpha/.git/objects</code>中去。</p>
</li>
<li><p>将引用文件中的<code>alpha/.git/refs/remotes/bravo/master</code>指向提交<code>12</code></p>
</li>
<li><p><code>alpha/.git/FETCH_HEAD</code>设置为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">94cd04d93ae88a1f53a4646532b1e8cdfbc0977f branch <span class="string">&#x27;master&#x27;</span> of ../bravo</span><br></pre></td></tr></table></figure>

<p>这意味着最近一次的获取命令获取到了<code>bravo</code>仓库的<code>master</code>分支的提交<code>12</code></p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxshpa0es1j31ay0u0mzq.jpg" alt="`alpha` after `bravo/master` fetched"></p>
<p>图形解读：对象可以被复制，也就是说提交历史可以被仓库共享</p>
<p>图形解读：仓库可以储存远程分支的引用，比如<code>alpha/.git/refs/remotes/bravo/master</code>。也就是说一个仓库可以在本地记录远程仓库的分支的状态，它获取到的远程分支的状态在获取的时候是保持同步的，但是远程分支的修改不会自动同步到本地仓库里。</p>
</li>
</ol>
<h3 id="合并FETCH-HEAD"><a href="#合并FETCH-HEAD" class="headerlink" title="合并FETCH_HEAD"></a>合并<code>FETCH_HEAD</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git merge FETCH_HEAD</span><br><span class="line">					Updating d14c7d2..94cd04d</span><br><span class="line">					Fast-forward</span><br></pre></td></tr></table></figure>

<p>用户合并了<code>FETCH_HEAD</code>。<code>FETCH_HEAD</code>只不过另一个引用，它指向被合并者的提交<code>12</code>，<code>HEAD</code>指向合并者的提交<code>11</code>。Git执行了一次快进合并，并将<code>master</code>指向提交<code>12</code>。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxshw5jqwrj31ay0u0jtw.jpg" alt="`alpha` after `FETCH_HEAD` merged"></p>
<h3 id="从远程仓库拉分支"><a href="#从远程仓库拉分支" class="headerlink" title="从远程仓库拉分支"></a>从远程仓库拉分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git pull bravo master</span><br><span class="line">					Already up-to-date</span><br></pre></td></tr></table></figure>

<p>用户从<code>alpha</code>仓库拉远程<code>bravo</code>仓库的<code>master</code>分支。拉（pull）是获取(fetch)和合并(merge)<code>FETCH_HEAD</code>的简写。Git会执行者两个命令，并显示<code>master</code>分支已经<code>Already up-to-date</code></p>
<h3 id="克隆一个仓库"><a href="#克隆一个仓库" class="headerlink" title="克隆一个仓库"></a>克隆一个仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">cd</span> ..</span><br><span class="line">			~ $ git <span class="built_in">clone</span> alpha charlie</span><br><span class="line">					Cloning into <span class="string">&#x27;charlie&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户进入上一级路径，将<code>alpha</code>仓库克隆到<code>charlie</code>仓库。克隆到<code>charlie</code>仓库的结果与用户使用<code>cp</code>命令聊创建<code>bravo</code>仓库类似，Git会创建一个新的名为<code>charlie</code>的仓库，初始化<code>charlie</code>为一个Git仓库，添加<code>alpha</code>作为远程仓库，并将远程仓库命名为<code>origin</code>，获取<code>origin</code>并合并<code>FETCH_HEAD</code></p>
<h3 id="将内容推到远程仓库的分支"><a href="#将内容推到远程仓库的分支" class="headerlink" title="将内容推到远程仓库的分支"></a>将内容推到远程仓库的分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">			~ $ <span class="built_in">cd</span> alpha</span><br><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;13&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;13&#x27;</span></span><br><span class="line">					[master 3238468] 13</span><br></pre></td></tr></table></figure>

<p>用户回到<code>alpha</code>仓库，修改<code>data/number.txt</code>的内容为<code>13</code>并提交修改到<code>alpha</code>的<code>master</code>分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git remote add charlie ../charlie</span><br></pre></td></tr></table></figure>

<p>设置<code>charlie</code>为<code>alpha</code>仓库的远程仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git push charlie master</span><br><span class="line">					Writing objects: 100%</span><br><span class="line">					remote error: refusing to update checked out </span><br><span class="line">					branch: refs/heads/master because it will make </span><br><span class="line">					the index and work tree inconsistent</span><br></pre></td></tr></table></figure>

<p>用户尝试将<code>master</code>分支推到<code>charlie</code></p>
<p>所有的提交<code>13</code>相关的对象都被拷贝到<code>charlie</code></p>
<p>用户需要创建一个新的分支，合并提交<code>13</code>再推到推到<code>charlie</code>。但实际上，用户希望有一个能随时推随时拉的仓库，就像GitHub的远程那样，他们需要一个bare仓库。</p>
<h3 id="克隆一个bare仓库"><a href="#克隆一个bare仓库" class="headerlink" title="克隆一个bare仓库"></a>克隆一个bare仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">cd</span> ..</span><br><span class="line">			~ $ git <span class="built_in">clone</span> alpha delta --bare</span><br><span class="line">					Cloning into bare repository <span class="string">&#x27;delta&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用户进入到上一级目录，把<code>delta</code>克隆为一个bare仓库。这和普通的克隆仓库有两点不同。<code>config</code>配置文件会表明这个仓库是一个bare仓库。另外，存在<code>.git</code>目录下的文件会存到根目录下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delta</span><br><span class="line">	- HEAD</span><br><span class="line">	- config</span><br><span class="line">	- objects</span><br><span class="line">	- refs</span><br></pre></td></tr></table></figure>

<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxsro47bt2j30pm0cx74y.jpg" alt="image-20181202222437115"></p>
<h3 id="将分支推到bare仓库"><a href="#将分支推到bare仓库" class="headerlink" title="将分支推到bare仓库"></a>将分支推到bare仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">			~ $ <span class="built_in">cd</span> alpha</span><br><span class="line">~/alpha $ git remote add delta ../delta</span><br></pre></td></tr></table></figure>

<p>用户回到<code>alpha</code>目录下，将<code>delta</code>设置为<code>alpha</code>的远程仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ <span class="built_in">printf</span> <span class="string">&#x27;14&#x27;</span> &gt; data/number.txt</span><br><span class="line">~/alpha $ git add data/number.txt</span><br><span class="line">~/alpha $ git commit -m <span class="string">&#x27;14&#x27;</span></span><br><span class="line">					[master cb51da8] 14</span><br></pre></td></tr></table></figure>

<p>将<code>data/number/txt</code>的内容设置为<code>14</code>，并提交到<code>alpha</code>的<code>master</code>分支</p>
<p>![image-20181202222812723](&#x2F;Users&#x2F;quanxu&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20181202222812723.png)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/alpha $ git push delta master</span><br><span class="line">					Writing objects: 100%</span><br><span class="line">					To ../delta</span><br><span class="line">						3238468..cb51da8 master -&gt; master</span><br></pre></td></tr></table></figure>

<p>将内容推到<code>delta</code>的<code>master</code>分支，总共分三步：</p>
<ol>
<li>与提交<code>14</code>相关的所有对象都从<code>alpha/.git/objects/</code>路径拷贝到<code>delta/objects/</code></li>
<li><code>delta/refs/heads/master</code>更新到提交<code>14</code></li>
<li><code>alpha/.git/refs/remotes/delta/master</code>被设为指向提交<code>14</code>。</li>
</ol>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxss4il1mnj30pj0ggq4d.jpg" alt="image-20181202224004269"></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/git/" rel="tag"># git</a>
              <a href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag"># 翻译</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/11/18/ant-design-%E7%BB%84%E4%BB%B6%E5%88%97%E8%A1%A8/" rel="prev" title="ant design 组件列表">
                  <i class="fa fa-angle-left"></i> ant design 组件列表
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/12/05/React%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E9%AB%98%E9%98%B6/" rel="next" title="React学习笔记高阶">
                  React学习笔记高阶 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2018 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Xu Quan（Nikkkki）</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"IcWbltr2BErnzeh08rQq5Awt-MdYXbMMI","app_key":"MBmkp7Em4UZXFeXVz4D0XIL2","server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"xuquan","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
